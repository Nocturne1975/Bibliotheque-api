// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Membre {
  id             Int      @id @default(autoincrement())
  nom            String
  prenom         String
  email          String   @unique
  telephone      String?
  dateInscription DateTime @default(now())
  actif          Boolean  @default(true)
  emprunts       Emprunt[]

  @@index([email])
}

model Livre {
  id              Int      @id @default(autoincrement())
  titre           String
  isbn            String   @unique
  auteur          String
  editeur         String?
  anneePublication Int?
  categorie       String?
  disponible      Boolean  @default(true)
  emprunts        Emprunt[]

  @@index([isbn])
  @@index([categorie])
  @@index([auteur])
}

enum StatutEmprunt {
  EN_COURS
  RETOURNE
  EN_RETARD
}

model Emprunt {
  id                 Int          @id @default(autoincrement())
  membreId           Int
  livreId            Int
  dateEmprunt        DateTime
  dateRetourPrevue   DateTime
  dateRetourEffective DateTime?
  statut             StatutEmprunt
  prolonge           Boolean      @default(false)

  membre             Membre       @relation(fields: [membreId], references: [id])
  livre              Livre        @relation(fields: [livreId], references: [id])

  @@index([membreId])
  @@index([livreId])
  @@index([statut])
}

model Reservation {
  id              Int      @id @default(autoincrement())
  membreId        Int
  livreId         Int
  statut          String   @default("ACTIVE") // ACTIVE, ANNULEE, SATISFAITE
  dateReservation DateTime @default(now())
  createdAt       DateTime @default(now())

  membre          Membre   @relation(fields: [membreId], references: [id])
  livre           Livre    @relation(fields: [livreId], references: [id])

  @@index([membreId])
  @@index([livreId])
  @@index([statut])
}